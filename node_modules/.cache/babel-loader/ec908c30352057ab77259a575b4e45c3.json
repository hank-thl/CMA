{"ast":null,"code":"import axios from \"axios\";\nimport $ from \"jquery\";\nexport default {\n  name: \"CheckOut\",\n\n  data() {\n    return {\n      cart: [],\n      isVisible: false,\n      deliveryType: \"delivery\",\n      payMethod: \"\",\n      customerAddress: \"\",\n      totalprice: 0,\n      receiver: \"sameAsOrder\",\n      memberId: 0,\n      memberInfo: {}\n    };\n  },\n\n  mounted() {\n    axios.get(`http://localhost:8081/api/cart/checkout`).then(res => {\n      this.cart = res.data;\n    });\n    this.total = 0;\n    $.each(this.cart, (index, products) => {\n      this.total += parseInt(products.productPrice);\n    }); //檢查是不是linepay回呼\n\n    let transactionId = new URLSearchParams(window.location.search).get(\"transactionId\");\n\n    if (transactionId != null) {\n      //是linepay回呼\n      var settings = {\n        url: \"http://localhost:8080/#/checkout\" + transactionId,\n        method: \"GET\"\n      };\n      $.ajax(settings).done(function (response) {\n        if (response == \"ok\") {\n          alert(\"付款成功...跳轉回dashboard\");\n        } else {\n          //付款失敗,應該要呼叫database把訂單狀態改成取消\n          alert(response);\n        }\n      });\n    }\n  },\n\n  methods: {\n    getCart() {\n      axios.get(`http://localhost:8081/api/cart/checkout`).then(res => {\n        this.cart = res.data;\n      });\n    },\n\n    getMemberId() {\n      axios.post(`http://localhost:8081/dashboardGetMemberId`).then(res => {\n        this.memberId = res.data;\n      });\n    },\n\n    getCheckOut() {\n      this.getMemberId;\n      this.isVisible = true;\n      axios.get(`http://localhost:8081/api/member/${this.memerId}`).then(res => {\n        this.memberInfo = JSON.parse(res.data);\n      });\n    },\n\n    addSingleProduct(id) {\n      console.log(id);\n      axios.get(`http://localhost:8081/api/cart/add/${id}/qty/`).then(response => console.log(response)).catch(error => console.log(error));\n    },\n\n    minusSingleProduct(id) {\n      console.log(id);\n      axios.get(`http://localhost:8081/api/cart/minus/${id}/qty/`).then(response => console.log(response)).catch(error => console.log(error));\n    },\n\n    removeSingleProducts(id) {\n      console.log(id);\n      axios.get(`http://localhost:8081/api/cart/remove/${id}`).then(response => console.log(response)).catch(error => console.log(error));\n    },\n\n    submitOrder() {\n      var orderId = this.createOrderId;\n      var settings = {\n        url: \"http://localhost:8081/api/orders/createOrder\",\n        method: \"POST\",\n        headers: {\n          \"Content-Type\": \"application/json\"\n        },\n        data: JSON.stringify({\n          orderId: orderId,\n          memberId: 4,\n          //應該要抓session的會員資訊,但目前前台網頁還沒整合到project無法做session控管所以寫死\n          payMethod: this.payMethod,\n          //抓前端表格內容\n          deliverCvs: $(\".cvs\").val(),\n          //抓前端表格內容(下拉式選單的超商名稱)\n          deliverAddr: $(\"#test003\").val() //如果使用者選擇宅配有輸入地址的話\n\n        })\n      };\n      $.ajax(settings).done(function (resp) {\n        if (this.payMethod == \"LinePay\") {\n          var settings = {\n            url: \"http://localhost:8081/api/orders/linepay/request\",\n            method: \"POST\",\n            headers: {\n              \"Content-Type\": \"application/json\"\n            },\n            data: JSON.stringify({\n              amount: this.totalprice,\n              productName: \"JavaEEIT42 Linepay付款\",\n              orderId: orderId\n            })\n          };\n          $.ajax(settings).done(function (response) {\n            console.log(response);\n            window.location.href = response;\n          }).fail(function () {\n            alert(\"呼叫LinePay失敗,請使用其他付款方式\");\n          });\n        } else {\n          alert(resp);\n          window.location.href = \"/home\";\n        }\n      }).fail(function (resp) {\n        alert(resp);\n      });\n    },\n\n    createOrderId() {\n      var date = new Date();\n      var month = date.getMonth() + 1;\n      var strDate = date.getDate();\n      return date.getFullYear() + this.padTo2Digits(month) + this.padTo2Digits(strDate) + this.padTo2Digits(date.getHours()) + this.padTo2Digits(date.getMinutes()) + this.padTo2Digits(date.getSeconds());\n    },\n\n    padTo2Digits(num) {\n      return num.toString().padStart(2, \"0\");\n    }\n\n  },\n  watch: {\n    \"$route.params.memberId\": function (memberId) {\n      this.memberId = memberId;\n    }\n  }\n};","map":{"version":3,"mappings":"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","names":["axios","$","name","data","cart","isVisible","deliveryType","payMethod","customerAddress","totalprice","receiver","memberId","memberInfo","mounted","get","then","res","total","each","index","products","parseInt","productPrice","transactionId","URLSearchParams","window","location","search","settings","url","method","ajax","done","response","alert","methods","getCart","getMemberId","post","getCheckOut","memerId","JSON","parse","addSingleProduct","id","console","log","catch","error","minusSingleProduct","removeSingleProducts","submitOrder","orderId","createOrderId","headers","stringify","deliverCvs","val","deliverAddr","resp","amount","productName","href","fail","date","Date","month","getMonth","strDate","getDate","getFullYear","padTo2Digits","getHours","getMinutes","getSeconds","num","toString","padStart","watch"],"sourceRoot":"","sources":["/Users/hank/Desktop/Vue/Vue3/hello-world/src/components/CheckOut.vue"],"sourcesContent":["<template>\n  <div>\n    <div class=\"container\">\n      <div class=\"cart\">\n        <div class=\"page-title\">\n          <h2>Shopping Cart</h2>\n        </div>\n        <div class=\"table-responsive\">\n          <!-- 這邊應該是form交給後端處理 -->\n          <div>\n            <!-- <form method=\"post\" action=\"#updatePost/\"> -->\n            <fieldset>\n              <table class=\"data-table cart-table\" id=\"shopping-cart-table\">\n                <thead>\n                  <tr class=\"first last\">\n                    <th rowspan=\"1\"></th>\n                    <th rowspan=\"1\"><span class=\"nobr\">產品名稱</span></th>\n                    <th rowspan=\"1\"></th>\n                    <th colspan=\"1\" class=\"a-center\">\n                      <span class=\"nobr\">價格</span>\n                    </th>\n                    <th class=\"a-center qty-middle\" rowspan=\"1\">數量</th>\n                    <th colspan=\"1\" class=\"a-center\">總價</th>\n                    <th class=\"a-center\" rowspan=\"1\"></th>\n                  </tr>\n                </thead>\n                <tfoot>\n                  <tr class=\"first last\">\n                    <td class=\"a-right last\" colspan=\"50\">\n                      <button\n                        class=\"button btn-continue\"\n                        title=\"Continue Shopping\"\n                        type=\"button\"\n                      >\n                        <span>繼續購物</span>\n                      </button>\n                      <button\n                        @click=\"getCheckOut()\"\n                        class=\"button btn-update\"\n                        title=\"Update Cart\"\n                        value=\"update_qty\"\n                        name=\"update_cart_action\"\n                      >\n                        <span>結帳</span>\n                      </button>\n                      <button\n                        id=\"empty_cart_button\"\n                        class=\"button btn-empty\"\n                        title=\"Clear Cart\"\n                        value=\"empty_cart\"\n                        name=\"update_cart_action\"\n                        type=\"submit\"\n                      >\n                        <span>清空購物車</span>\n                      </button>\n                    </td>\n                  </tr>\n                </tfoot>\n                <tbody id=\"putHere\">\n                  <div id=\"jspPutHere\"></div>\n                  <template v-for=\"item in cart\">\n                    <tr\n                      v-if=\"cart != '購物車內目前沒有商品!'\"\n                      :key=\"item.productId\"\n                      class=\"classItem${ItemCnt}\"\n                      id=\"item${ItemCnt}\"\n                    >\n                      <td class=\"image\">\n                        <a\n                          class=\"product-image\"\n                          href=\"#/women-s-crepe-printed-black/\"\n                          ><img\n                            width=\"75\"\n                            alt=\"Sample Product\"\n                            :src=\"item.productImg\"\n                        /></a>\n                      </td>\n                      <td>\n                        <h2 class=\"product-name\">\n                          <a href=\"#/women-s-crepe-printed-black/\">{{\n                            item.productName\n                          }}</a>\n                        </h2>\n                      </td>\n                      <td class=\"a-center\">\n                        <a\n                          title=\"Edit item parameters\"\n                          class=\"edit-bnt\"\n                          href=\"#configure/id/15945/\"\n                        ></a>\n                      </td>\n                      <td class=\"a-right\">\n                        <span class=\"cart-price\">\n                          <span class=\"price\">$</span\n                          ><span class=\"price\" id=\"price${ItemCnt}\">{{\n                            item.productPrice\n                          }}</span></span\n                        >\n                      </td>\n                      <td class=\"a-center movewishlist qty-middle\">\n                        <form id=\"myform\" method=\"POST\" action=\"#\">\n                          <input\n                            type=\"button\"\n                            value=\"-\"\n                            class=\"qtyminus btn btn-success\"\n                            field=\"quantity${ItemCnt}\"\n                            @click=\"\n                              minusSingleProduct(item.productId), getCart()\n                            \"\n                          />\n                          <input\n                            type=\"text\"\n                            name=\"quantity${ItemCnt}\"\n                            :value=\"item.qty\"\n                            disabled=\"disabled\"\n                            class=\"qty\"\n                            id=\"quantity${ItemCnt}\"\n                          />\n                          <input\n                            type=\"button\"\n                            value=\"+\"\n                            class=\"qtyplus btn btn-success\"\n                            field=\"quantity${ItemCnt}\"\n                            @click=\"addSingleProduct(item.productId), getCart()\"\n                          />\n                        </form>\n                      </td>\n                      <td class=\"a-right movewishlist\">\n                        <span class=\"cart-price\"\n                          ><span class=\"price\" id=\"totalPrice${ItemCnt}\"\n                            >${{ item.singleTotal }}</span\n                          ></span\n                        >\n                      </td>\n                      <td class=\"a-center last\">\n                        <button\n                          id=\"remove${ItemCnt}\"\n                          class=\"button remove\"\n                          title=\"Remove item\"\n                          @click=\"\n                            removeSingleProducts(item.productId), getCart()\n                          \"\n                        >\n                          <span>Remove item</span>\n                        </button>\n                      </td>\n                    </tr>\n                  </template>\n                </tbody>\n              </table>\n            </fieldset>\n          </div>\n        </div>\n      </div>\n    </div>\n    <!-- ------------------------------------------------ -->\n    <div\n      v-if=\"isVisible\"\n      id=\"checkOut\"\n      class=\"main-container col2-right-layout\"\n    >\n      <div class=\"main container\">\n        <div class=\"row\">\n          <section class=\"col-sm-12 col-xs-12\">\n            <div class=\"col-main\">\n              <div class=\"page-title\">\n                <h1>結帳</h1>\n              </div>\n              <ol class=\"one-page-checkout\" id=\"checkoutSteps\">\n                <li id=\"opc-billing\" class=\"section allow\">\n                  <!-- 綁定會員資料 -->\n                  <div class=\"step-title\">\n                    <span class=\"number\">1</span>\n                    <h3>訂購人資料</h3>\n                  </div>\n                  <div id=\"checkout-step-billing\" class=\"step a-item\">\n                    <table>\n                      <tr>\n                        <th>姓名:</th>\n                        <td>\n                          {{\n                            memberInfo.memberFirstname +\n                            \" \" +\n                            memberInfo.memberLastname\n                          }}\n                        </td>\n                      </tr>\n                      <tr>\n                        <th>E-Mail:</th>\n                        <td>{{ memberInfo.memberEmail }}</td>\n                      </tr>\n                      <tr>\n                        <th>聯絡電話:</th>\n                        <td>{{ memberInfo.memberTel }}</td>\n                      </tr>\n                      <tr>\n                        <th>地址:</th>\n                        <td>{{ memberInfo.memberAddr }}</td>\n                      </tr>\n                    </table>\n                  </div>\n                </li>\n                <li id=\"opc-shipping\" class=\"section\">\n                  <div class=\"step-title\">\n                    <span class=\"number\">2</span>\n                    <h3 class=\"one_page_heading\">寄送方式</h3>\n                  </div>\n                  <div id=\"checkout-step-billing\" class=\"step a-item\">\n                    <label for=\"delivery\">\n                      <input\n                        type=\"radio\"\n                        name=\"opc-shipping_method\"\n                        id=\"delivery\"\n                        value=\"delivery\"\n                        class=\"radio\"\n                        v-model=\"deliveryType\"\n                      />宅配到府\n                    </label>\n                    <label>\n                      <input\n                        type=\"radio\"\n                        name=\"opc-shipping_method\"\n                        value=\"FamilyMart\"\n                        class=\"radio\"\n                        v-model=\"deliveryType\"\n                      />全家超商取貨\n                    </label>\n                    <label>\n                      <input\n                        type=\"radio\"\n                        name=\"opc-shipping_method\"\n                        id=\"7-ELEVEN\"\n                        value=\"7-ELEVEN\"\n                        class=\"radio\"\n                        v-model=\"deliveryType\"\n                      />7-11超商取貨\n                    </label>\n\n                    <br />\n                    <template v-if=\"deliveryType === 'delivery'\">\n                      <tr>\n                        <th>宅配地址：</th>\n                        <td>\n                          <input\n                            type=\"text\"\n                            key=\"delivery\"\n                            style=\"width: 400px\"\n                            v-model=\"customerAddress\"\n                          />\n                        </td>\n                      </tr>\n                    </template>\n                    <template v-else-if=\"deliveryType === '7-ELEVEN'\">\n                      門市名稱：\n                      <input\n                        type=\"text\"\n                        name=\"cvs\"\n                        list=\"cvs\"\n                        class=\"cvs\"\n                        value=\"\"\n                      />\n                      <datalist id=\"cvs\">\n                        <option value=\"7-ELEVEN 三中門市\"></option>\n                        <option value=\"7-ELEVEN 明義門市\"></option>\n                      </datalist>\n                    </template>\n                    <template v-else-if=\"deliveryType === 'FamilyMart'\">\n                      門市名稱：\n                      <input\n                        type=\"text\"\n                        name=\"cvs\"\n                        list=\"cvs\"\n                        class=\"cvs\"\n                        value=\"\"\n                      />\n                      <datalist id=\"cvs\">\n                        <option value=\"全家 台中公益路大進店\"></option>\n                        <option value=\"全家 台中精誠店\"></option>\n                      </datalist>\n                    </template>\n\n                    <br />\n                  </div>\n                </li>\n                <li id=\"opc-shipping_method\" class=\"section\">\n                  <div class=\"step-title\">\n                    <span class=\"number\">3</span>\n                    <h3 class=\"one_page_heading\">收件人資料</h3>\n                  </div>\n                  <div id=\"checkout-step-billing\" class=\"step a-item\">\n                    <input\n                      type=\"radio\"\n                      name=\"customerInfo\"\n                      id=\"sameAsOrder\"\n                      value=\"sameAsOrder\"\n                      class=\"radio\"\n                      v-model=\"receiver\"\n                    />\n                    <label for=\"sameAsOrder\">同訂購人 </label>\n                    <input\n                      type=\"radio\"\n                      name=\"customerInfo\"\n                      id=\"changeReceiver\"\n                      value=\"changeReceiver\"\n                      class=\"radio\"\n                      v-model=\"receiver\"\n                    />\n                    <label for=\"changeReceiver\">修改收件人資料 </label>\n                    <br />\n                    <template v-if=\"receiver == 'sameAsOrder'\">\n                      <tr>\n                        <th>姓名：</th>\n                        <td>\n                          <p>\n                            {{\n                              memberInfo.memberFirstname +\n                              \" \" +\n                              memberInfo.memberLastname\n                            }}\n                          </p>\n                        </td>\n                        <br />\n                      </tr>\n                      <tr>\n                        <th>聯絡電話：</th>\n                        <td>\n                          <p>{{ memberInfo.memberTel }}</p>\n                        </td>\n                      </tr>\n                    </template>\n                    <template v-if=\"receiver == 'changeReceiver'\">\n                      <tr>\n                        <th>姓名：</th>\n                        <td>\n                          <input type=\"text\" />\n                        </td>\n                      </tr>\n                      <br />\n                      <tr>\n                        <th>聯絡電話：</th>\n                        <td>\n                          <input type=\"text\" />\n                        </td>\n                      </tr>\n                    </template>\n                  </div>\n                </li>\n                <li id=\"opc-payment\" class=\"section\">\n                  <div class=\"step-title\">\n                    <span class=\"number\">4</span>\n                    <h3 class=\"one_page_heading\">付款方式</h3>\n                  </div>\n                  <div id=\"checkout-step-billing\" class=\"step a-item\">\n                    <label for=\"COD\">\n                      <input\n                        type=\"radio\"\n                        name=\"payment\"\n                        id=\"COD\"\n                        value=\"COD\"\n                        v-model=\"payMethod\"\n                        class=\"radio\"\n                      />門市取貨付款\n                    </label>\n                    <label for=\"creditCard\">\n                      <input\n                        type=\"radio\"\n                        name=\"payment\"\n                        id=\"creditCard\"\n                        value=\"creditCard\"\n                        v-model=\"payMethod\"\n                        class=\"radio\"\n                      />信用卡\n                    </label>\n\n                    <label for=\"LinePay\">\n                      <input\n                        type=\"radio\"\n                        name=\"payment\"\n                        id=\"LinePay\"\n                        value=\"LinePay\"\n                        v-model=\"payMethod\"\n                        class=\"radio\"\n                      />Line Pay\n                    </label>\n                    <br />\n                    <template v-if=\"payMethod === 'creditCard'\">\n                      <tr>\n                        <th>信用卡號：</th>\n                        <td>\n                          <input type=\"text\" />\n                        </td>\n                      </tr>\n                      <br />\n                      <tr>\n                        <th>有效日期：</th>\n                        <td>\n                          <select name=\"validMonth\" id=\"\" style=\"width: 80px\">\n                            <option value=\"0\">請選擇</option>\n                            <option value=\"1\">01</option>\n                            <option value=\"2\">02</option>\n                            <option value=\"3\">03</option>\n                            <option value=\"4\">04</option>\n                            <option value=\"5\">05</option>\n                            <option value=\"6\">06</option>\n                            <option value=\"7\">07</option>\n                            <option value=\"8\">08</option>\n                            <option value=\"9\">09</option>\n                            <option value=\"10\">10</option>\n                            <option value=\"11\">11</option>\n                            <option value=\"12\">12</option>\n                          </select>\n                          <select name=\"validYear\" id=\"\" style=\"width: 80px\">\n                            <option value=\"0\">請選擇</option>\n                            <option value=\"1\">01</option>\n                            <option value=\"2\">02</option>\n                            <option value=\"3\">03</option>\n                            <option value=\"4\">04</option>\n                            <option value=\"5\">05</option>\n                            <option value=\"6\">06</option>\n                            <option value=\"7\">07</option>\n                            <option value=\"8\">08</option>\n                            <option value=\"9\">09</option>\n                            <option value=\"10\">10</option>\n                            <option value=\"11\">11</option>\n                            <option value=\"12\">12</option>\n                          </select>\n                          <input type=\"text\" placeholder=\"信用卡背面末三碼\" />\n                        </td>\n                      </tr>\n                    </template>\n                  </div>\n                </li>\n                <li id=\"opc-review\" class=\"section\">\n                  <div class=\"step-title\">\n                    <span class=\"number\">5</span>\n                    <h3 class=\"one_page_heading\">訂單總覽</h3>\n                  </div>\n                  <div id=\"checkout-step-billing\" class=\"step a-item\">\n                    <button\n                      @click=\"submitOrder()\"\n                      type=\"button\"\n                      class=\"button continue\"\n                    >\n                      <span>確認結帳</span>\n                    </button>\n                  </div>\n                </li>\n              </ol>\n            </div>\n          </section>\n        </div>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script>\nimport axios from \"axios\";\nimport $ from \"jquery\";\n\nexport default {\n  name: \"CheckOut\",\n  data() {\n    return {\n      cart: [],\n      isVisible: false,\n      deliveryType: \"delivery\",\n      payMethod: \"\",\n      customerAddress: \"\",\n      totalprice: 0,\n      receiver: \"sameAsOrder\",\n      memberId: 0,\n      memberInfo: {},\n    };\n  },\n  mounted() {\n    axios.get(`http://localhost:8081/api/cart/checkout`).then((res) => {\n      this.cart = res.data;\n    });\n    this.total = 0;\n    $.each(this.cart, (index, products) => {\n      this.total += parseInt(products.productPrice);\n    });\n\n    //檢查是不是linepay回呼\n    let transactionId = new URLSearchParams(window.location.search).get(\n      \"transactionId\"\n    );\n    if (transactionId != null) {\n      //是linepay回呼\n      var settings = {\n        url: \"http://localhost:8080/#/checkout\" + transactionId,\n        method: \"GET\",\n      };\n      $.ajax(settings).done(function (response) {\n        if (response == \"ok\") {\n          alert(\"付款成功...跳轉回dashboard\");\n        } else {\n          //付款失敗,應該要呼叫database把訂單狀態改成取消\n          alert(response);\n        }\n      });\n    }\n  },\n\n  methods: {\n    getCart() {\n      axios.get(`http://localhost:8081/api/cart/checkout`).then((res) => {\n        this.cart = res.data;\n      });\n    },\n    getMemberId() {\n      axios.post(`http://localhost:8081/dashboardGetMemberId`).then((res) => {\n        this.memberId = res.data;\n      });\n    },\n    getCheckOut() {\n      this.getMemberId;\n      this.isVisible = true;\n\n      axios\n        .get(`http://localhost:8081/api/member/${this.memerId}`)\n        .then((res) => {\n          this.memberInfo = JSON.parse(res.data);\n        });\n    },\n    addSingleProduct(id) {\n      console.log(id);\n\n      axios\n        .get(`http://localhost:8081/api/cart/add/${id}/qty/`)\n        .then((response) => console.log(response))\n        .catch((error) => console.log(error));\n    },\n    minusSingleProduct(id) {\n      console.log(id);\n      axios\n        .get(`http://localhost:8081/api/cart/minus/${id}/qty/`)\n        .then((response) => console.log(response))\n        .catch((error) => console.log(error));\n    },\n    removeSingleProducts(id) {\n      console.log(id);\n\n      axios\n        .get(`http://localhost:8081/api/cart/remove/${id}`)\n        .then((response) => console.log(response))\n        .catch((error) => console.log(error));\n    },\n    submitOrder() {\n      var orderId = this.createOrderId;\n      var settings = {\n        url: \"http://localhost:8081/api/orders/createOrder\",\n        method: \"POST\",\n        headers: {\n          \"Content-Type\": \"application/json\",\n        },\n        data: JSON.stringify({\n          orderId: orderId,\n          memberId: 4, //應該要抓session的會員資訊,但目前前台網頁還沒整合到project無法做session控管所以寫死\n          payMethod: this.payMethod, //抓前端表格內容\n          deliverCvs: $(\".cvs\").val(), //抓前端表格內容(下拉式選單的超商名稱)\n          deliverAddr: $(\"#test003\").val(), //如果使用者選擇宅配有輸入地址的話\n        }),\n      };\n\n      $.ajax(settings)\n        .done(function (resp) {\n          if (this.payMethod == \"LinePay\") {\n            var settings = {\n              url: \"http://localhost:8081/api/orders/linepay/request\",\n              method: \"POST\",\n              headers: {\n                \"Content-Type\": \"application/json\",\n              },\n              data: JSON.stringify({\n                amount: this.totalprice,\n                productName: \"JavaEEIT42 Linepay付款\",\n                orderId: orderId,\n              }),\n            };\n            $.ajax(settings)\n              .done(function (response) {\n                console.log(response);\n                window.location.href = response;\n              })\n              .fail(function () {\n                alert(\"呼叫LinePay失敗,請使用其他付款方式\");\n              });\n          } else {\n            alert(resp);\n            window.location.href = \"/home\";\n          }\n        })\n        .fail(function (resp) {\n          alert(resp);\n        });\n    },\n    createOrderId() {\n      var date = new Date();\n      var month = date.getMonth() + 1;\n      var strDate = date.getDate();\n      return (\n        date.getFullYear() +\n        this.padTo2Digits(month) +\n        this.padTo2Digits(strDate) +\n        this.padTo2Digits(date.getHours()) +\n        this.padTo2Digits(date.getMinutes()) +\n        this.padTo2Digits(date.getSeconds())\n      );\n    },\n    padTo2Digits(num) {\n      return num.toString().padStart(2, \"0\");\n    },\n  },\n  watch: {\n    \"$route.params.memberId\": function (memberId) {\n      this.memberId = memberId;\n    },\n  },\n};\n</script>\n\n<style scoped>\n.cart {\n  margin: 30px 0 0 0;\n}\n</style>\n"]},"metadata":{},"sourceType":"module"}